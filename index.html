<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Inventarios IDIP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 20px;
        }

        .logo-container {
            flex-shrink: 0;
        }

        .logo {
            height: 80px;
            width: auto;
            filter: drop-shadow(0 4px 8px rgba(30, 58, 138, 0.2));
        }

        .header-text {
            flex: 1;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header-subtitle {
            color: #475569;
            font-size: 1.1em;
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(30, 58, 138, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.2);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .critical { color: #dc2626; }
        .warning { color: #ea580c; }
        .success { color: #059669; }
        .info { color: #2563eb; }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .section h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #1e3a8a;
            font-weight: 600;
        }

        .product-list {
            margin-bottom: 20px;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s ease;
        }

        .product-item:hover {
            transform: scale(1.02);
        }

        .critical-item { 
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(239, 68, 68, 0.05)); 
            border-left: 4px solid #dc2626; 
        }
        .warning-item { 
            background: linear-gradient(135deg, rgba(234, 88, 12, 0.1), rgba(251, 146, 60, 0.05)); 
            border-left: 4px solid #ea580c; 
        }
        .success-item { 
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(34, 197, 94, 0.05)); 
            border-left: 4px solid #059669; 
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #1e3a8a;
        }

        .product-details {
            font-size: 0.9em;
            color: #64748b;
        }

        .product-stock {
            text-align: right;
            font-weight: 600;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
        }

        .inventory-table th {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            font-weight: 600;
            color: #1e3a8a;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .badge-critical { background: #dc2626; color: white; }
        .badge-warning { background: #ea580c; color: white; }
        .badge-success { background: #059669; color: white; }

        .action-buttons {
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6, #60a5fa);
            color: white;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.4);
        }

        .sync-status {
            margin-top: 15px; 
            padding: 15px; 
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(34, 197, 94, 0.05)); 
            border-radius: 12px; 
            border-left: 4px solid #059669;
        }

        .sync-status strong {
            color: #059669;
        }

        .sync-status a {
            color: #1e3a8a;
            text-decoration: none;
            font-weight: 600;
        }

        .sync-status a:hover {
            color: #3b82f6;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .reorder-calculation {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .no-alerts-message {
            text-align: center; 
            padding: 30px; 
            color: #059669;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(34, 197, 94, 0.05));
            border-radius: 12px;
            border: 1px solid rgba(5, 150, 105, 0.2);
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .logo {
                height: 60px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo-container">
                    <img src="https://idip.com.mx/wp-content/uploads/2024/08/logos-IDIP-sin-fondo-1-2.png" alt="IDIP Logo" class="logo">
                </div>
                <div class="header-text">
                    <h1>üì¶ Dashboard de Inventarios</h1>
                    <p class="header-subtitle">Sistema inteligente de control de stock con sincronizaci√≥n autom√°tica desde Google Sheets</p>
                </div>
            </div>
            <div class="sync-status">
                <strong>‚úÖ Conectado a Google Sheets:</strong> 
                <a href="https://docs.google.com/spreadsheets/d/14A7s3X1SYBsu1XATk2cTg9XtTE-t0gWm9CtTXv4l83M" target="_blank">
                    üìä Ver/Editar Hoja de Inventario
                </a>
                <div style="font-size: 0.9em; color: #64748b; margin-top: 5px;">
                    <span id="lastSync">√öltima sincronizaci√≥n: Cargando...</span>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number critical" id="criticalCount">2</div>
                <div>Productos Cr√≠ticos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number warning" id="warningCount">2</div>
                <div>Stock Bajo</div>
            </div>
            <div class="stat-card">
                <div class="stat-number success" id="normalCount">2</div>
                <div>Stock Normal</div>
            </div>
            <div class="stat-card">
                <div class="stat-number info" id="totalValue">$0.00 MXN</div>
                <div>Valor Total</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-grid">
            <!-- Alerts -->
            <div class="section">
                <h2>üö® Alertas Prioritarias</h2>
                
                <h3 style="color: #dc2626; margin-bottom: 15px;">üî¥ Cr√≠ticos - Pedir HOY</h3>
                <div class="product-list" id="criticalProducts">
                    <!-- Se llena autom√°ticamente desde Google Sheets -->
                </div>

                <h3 style="color: #ea580c; margin-bottom: 15px;">üü° Bajos - Planificar Esta Semana</h3>
                <div class="product-list" id="warningProducts">
                    <!-- Se llena autom√°ticamente desde Google Sheets -->
                </div>

                <div id="noAlertsMessage" class="no-alerts-message" style="display: none;">
                    <h3>üéâ ¬°Excelente!</h3>
                    <p>No hay productos con stock cr√≠tico o bajo.<br>Tu inventario est√° bien gestionado.</p>
                </div>
            </div>

            <!-- Charts -->
            <div class="section">
                <h2>üìä An√°lisis de Inventario</h2>
                <div class="chart-container">
                    <canvas id="inventoryChart"></canvas>
                </div>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #1e3a8a;">üí∞ C√°lculo de Reabastecimiento</h3>
                <div class="reorder-calculation" id="reorderCalculation">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span><strong>Productos Cr√≠ticos:</strong></span>
                        <span style="color: #dc2626;" id="criticalCost"><strong>$0.00 MXN</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span><strong>Productos Bajos:</strong></span>
                        <span style="color: #ea580c;" id="warningCost"><strong>$0.00 MXN</strong></span>
                    </div>
                    <hr style="margin: 10px 0; border: none; border-top: 1px solid rgba(59, 130, 246, 0.2);">
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>Total a Invertir:</strong></span>
                        <span style="color: #1e3a8a; font-size: 1.2em;" id="totalReorderCost"><strong>$0.00 MXN</strong></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Full Inventory Table -->
        <div class="section">
            <h2>üìã Inventario Completo</h2>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="loadInventoryFromSheets()">üîÑ Sincronizar Ahora</button>
                <button class="btn btn-primary" onclick="toggleAutoSync()">‚ö° <span id="autoSyncText">Activar Auto-Sync</span></button>
                <button class="btn btn-primary" onclick="exportToCSV()">üì§ Exportar CSV</button>
                <button class="btn btn-primary" onclick="generatePDFReport()">üìä Generar Reporte PDF</button>
            </div>
            
            <table class="inventory-table" id="inventoryTable">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Categor√≠a</th>
                        <th>Stock</th>
                        <th>Estado</th>
                        <th>Precio Compra</th>
                        <th>Precio Venta</th>
                        <th>Valor Total</th>
                        <th>Proveedor</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Configuraci√≥n de Google Sheets
        const GOOGLE_SHEETS_CONFIG = {
            // Tu Google Sheets ID
            SHEET_ID: '14A7s3X1SYBsu1XATk2cTg9XtTE-t0gWm9CtTXv4l83M',
            // Nombre de tu hoja
            SHEET_NAME: 'Inventario',
            // Rango de datos (A1:K100 significa columnas A a K, filas 1 a 100)
            RANGE: 'A1:K100'
        };

        // URL para acceder a Google Sheets como CSV
        function getGoogleSheetsURL() {
            return `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_CONFIG.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${GOOGLE_SHEETS_CONFIG.SHEET_NAME}&range=${GOOGLE_SHEETS_CONFIG.RANGE}`;
        }

        // Variable global para almacenar inventario
        let inventory = [];

        // Funci√≥n para cargar datos desde Google Sheets
        async function loadInventoryFromSheets() {
            try {
                // Mostrar estado de carga
                document.getElementById('lastSync').textContent = 'Sincronizando...';
                
                const response = await fetch(getGoogleSheetsURL());
                const csvText = await response.text();
                
                // Parsear CSV
                const lines = csvText.split('\n');
                const headers = lines[0].split(',').map(header => header.replace(/"/g, '').trim());
                
                inventory = [];
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = lines[i].split(',').map(value => value.replace(/"/g, '').trim());
                    
                    if (values.length >= 10 && values[0]) { // Verificar que hay datos
                        const product = {
                            name: values[0] || '',
                            sku: values[1] || '',
                            category: values[2] || '',
                            currentStock: parseInt(values[3]) || 0,
                            minStock: parseInt(values[4]) || 0,
                            maxStock: parseInt(values[5]) || 0,
                            buyPrice: parseFloat(values[6]) || 0,
                            sellPrice: parseFloat(values[7]) || 0,
                            supplier: values[8] || '',
                            location: values[9] || '',
                            notes: values[10] || ''
                        };
                        inventory.push(product);
                    }
                }
                
                console.log(`‚úÖ Cargados ${inventory.length} productos desde Google Sheets`);
                document.getElementById('lastSync').textContent = `√öltima sincronizaci√≥n: ${new Date().toLocaleString('es-MX')} - ${inventory.length} productos cargados`;
                updateDashboard();
                
            } catch (error) {
                console.error('‚ùå Error cargando desde Google Sheets:', error);
                document.getElementById('lastSync').textContent = `‚ùå Error de conexi√≥n. Verifica que tu Google Sheets est√© p√∫blico.`;
                
                // Mostrar mensaje de error en lugar de datos de ejemplo
                inventory = [];
                updateDashboard();
                
                // Mostrar alerta al usuario
                alert('‚ö†Ô∏è No se pudieron cargar los datos desde Google Sheets.\n\nVerifica que:\n1. Tu hoja est√© configurada como p√∫blica\n2. Tengas datos en la hoja "Inventario"\n3. Los headers est√©n en la fila 1');
            }
        }

        // Variables para auto-sincronizaci√≥n
        let autoSyncInterval = null;
        let isAutoSyncEnabled = false;

        // Funci√≥n para alternar auto-sincronizaci√≥n
        function toggleAutoSync() {
            if (isAutoSyncEnabled) {
                // Desactivar auto-sync
                clearInterval(autoSyncInterval);
                isAutoSyncEnabled = false;
                document.getElementById('autoSyncText').textContent = 'Activar Auto-Sync';
                document.getElementById('lastSync').innerHTML += ' | Auto-sync: <span style="color: #dc2626;">Desactivado</span>';
            } else {
                // Activar auto-sync cada 5 minutos
                autoSyncInterval = setInterval(loadInventoryFromSheets, 300000); // 5 minutos = 300000ms
                isAutoSyncEnabled = true;
                document.getElementById('autoSyncText').textContent = 'Desactivar Auto-Sync';
                document.getElementById('lastSync').innerHTML += ' | Auto-sync: <span style="color: #059669;">Cada 5 min</span>';
            }
        }

        // Funci√≥n para actualizar todo el dashboard
        function updateDashboard() {
            updateStats();
            populateInventoryTable();
            if (typeof createChart === 'function') createChart();
        }

        function getStockStatus(current, min) {
            if (current <= min) return 'critical';
            if (current <= min * 1.5) return 'warning';
            return 'normal';
        }

        function getStatusBadge(status) {
            const badges = {
                critical: '<span class="status-badge badge-critical">üî¥ CR√çTICO</span>',
                warning: '<span class="status-badge badge-warning">üü° BAJO</span>',
                normal: '<span class="status-badge badge-success">üü¢ NORMAL</span>'
            };
            return badges[status];
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN'
            }).format(amount);
        }

        function updateStats() {
            let critical = 0, warning = 0, normal = 0, totalValue = 0;
            let criticalCost = 0, warningCost = 0;
            
            inventory.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                const toOrder = Math.max(0, item.maxStock - item.currentStock);
                const orderCost = toOrder * item.buyPrice;
                
                if (status === 'critical') {
                    critical++;
                    criticalCost += orderCost;
                } else if (status === 'warning') {
                    warning++;
                    warningCost += orderCost;
                } else {
                    normal++;
                }
                
                totalValue += item.currentStock * item.buyPrice;
            });
            
            document.getElementById('criticalCount').textContent = critical;
            document.getElementById('warningCount').textContent = warning;
            document.getElementById('normalCount').textContent = normal;
            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            
            // Actualizar costos de reabastecimiento
            document.getElementById('criticalCost').innerHTML = `<strong>${formatCurrency(criticalCost)}</strong>`;
            document.getElementById('warningCost').innerHTML = `<strong>${formatCurrency(warningCost)}</strong>`;
            document.getElementById('totalReorderCost').innerHTML = `<strong>${formatCurrency(criticalCost + warningCost)}</strong>`;
            
            // Actualizar alertas din√°micamente
            updateAlertSections();
        }

        function updateAlertSections() {
            const criticalDiv = document.getElementById('criticalProducts');
            const warningDiv = document.getElementById('warningProducts');
            const noAlertsDiv = document.getElementById('noAlertsMessage');
            
            // Limpiar contenido previo
            criticalDiv.innerHTML = '';
            warningDiv.innerHTML = '';
            
            let hasCritical = false;
            let hasWarning = false;
            
            inventory.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                const toOrder = Math.max(0, item.maxStock - item.currentStock);
                
                if (status === 'critical') {
                    hasCritical = true;
                    criticalDiv.innerHTML += `
                        <div class="product-item critical-item">
                            <div class="product-info">
                                <div class="product-name">${item.name}</div>
                                <div class="product-details">SKU: ${item.sku} | ${item.supplier}</div>
                            </div>
                            <div class="product-stock">
                                <div style="color: #dc2626;">${item.currentStock} / ${item.minStock}</div>
                                <div style="font-size: 0.8em;">Pedir: ${toOrder} unidades</div>
                            </div>
                        </div>
                    `;
                } else if (status === 'warning') {
                    hasWarning = true;
                    warningDiv.innerHTML += `
                        <div class="product-item warning-item">
                            <div class="product-info">
                                <div class="product-name">${item.name}</div>
                                <div class="product-details">SKU: ${item.sku} | ${item.supplier}</div>
                            </div>
                            <div class="product-stock">
                                <div style="color: #ea580c;">${item.currentStock} / ${item.minStock}</div>
                                <div style="font-size: 0.8em;">Pedir: ${toOrder} unidades</div>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Mostrar mensaje si no hay alertas
            if (!hasCritical && !hasWarning) {
                noAlertsDiv.style.display = 'block';
            } else {
                noAlertsDiv.style.display = 'none';
            }
            
            // Si no hay productos cr√≠ticos, mostrar mensaje
            if (!hasCritical) {
                criticalDiv.innerHTML = '<p style="text-align: center; color: #059669; padding: 20px;">‚úÖ No hay productos en estado cr√≠tico</p>';
            }
            
            // Si no hay productos con warning, mostrar mensaje
            if (!hasWarning) {
                warningDiv.innerHTML = '<p style="text-align: center; color: #059669; padding: 20px;">‚úÖ No hay productos con stock bajo</p>';
            }
        }

        // Funci√≥n para exportar a CSV
        function exportToCSV() {
            if (inventory.length === 0) {
                alert('No hay datos para exportar. Sincroniza primero con Google Sheets.');
                return;
            }
            
            const headers = [
                'Producto', 'C√≥digo SKU', 'Categor√≠a', 'Stock Actual', 'Stock M√≠nimo', 
                'Stock M√°ximo', 'Precio Compra', 'Precio Venta', 'Proveedor', 'Ubicaci√≥n', 
                'Notas', 'Estado', 'Valor Total', 'Cantidad a Pedir'
            ];
            
            let csvContent = headers.join(',') + '\n';
            
            inventory.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                const statusText = status === 'critical' ? 'CR√çTICO' : status === 'warning' ? 'BAJO' : 'NORMAL';
                const totalValue = item.currentStock * item.buyPrice;
                const toOrder = status !== 'normal' ? Math.max(0, item.maxStock - item.currentStock) : 0;
                
                const row = [
                    `"${item.name}"`,
                    `"${item.sku}"`,
                    `"${item.category}"`,
                    item.currentStock,
                    item.minStock,
                    item.maxStock,
                    item.buyPrice,
                    item.sellPrice,
                    `"${item.supplier}"`,
                    `"${item.location}"`,
                    `"${item.notes}"`,
                    `"${statusText}"`,
                    totalValue.toFixed(2),
                    toOrder
                ];
                
                csvContent += row.join(',') + '\n';
            });
            
            // Crear y descargar archivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `inventario_idip_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Funci√≥n para generar reporte PDF
        function generatePDFReport() {
            if (inventory.length === 0) {
                alert('No hay datos para el reporte. Sincroniza primero con Google Sheets.');
                return;
            }
            
            // Calcular estad√≠sticas
            let critical = 0, warning = 0, normal = 0, totalValue = 0, totalToOrder = 0;
            
            inventory.forEach(item => {
                const status = getStockStatus(item.currentStock, item.minStock);
                if (status === 'critical') critical++;
                else if (status === 'warning') warning++;
                else normal++;
                
                totalValue += item.currentStock * item.buyPrice;
                if (status !== 'normal') {
                    totalToOrder += (item.maxStock - item.currentStock) * item.buyPrice;
                }
            });
            
            // Crear contenido HTML para el reporte
            const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Reporte de Inventario IDIP</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 40px; 
                            color: #1e3a8a;
                        }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 3px solid #3b82f6;
                            padding-bottom: 20px;
                        }
                        .logo { 
                            height: 60px; 
                            margin-bottom: 15px; 
                        }
                        .stats { 
                            display: grid; 
                            grid-template-columns: repeat(4, 1fr); 
                            gap: 20px; 
                            margin-bottom: 30px; 
                        }
                        .stat-box { 
                            padding: 15px; 
                            border: 2px solid #3b82f6; 
                            border-radius: 12px; 
                            text-align: center; 
                            background: #f8fafc;
                        }
                        .critical { background: #fee2e2; border-color: #dc2626; color: #dc2626; }
                        .warning { background: #fff7ed; border-color: #ea580c; color: #ea580c; }
                        .success { background: #ecfdf5; border-color: #059669; color: #059669; }
                        .info { background: #eff6ff; border-color: #2563eb; color: #2563eb; }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 20px; 
                        }
                        th, td { 
                            border: 1px solid #3b82f6; 
                            padding: 8px; 
                            text-align: left; 
                            font-size: 12px; 
                        }
                        th { 
                            background: #1e3a8a; 
                            color: white; 
                            font-weight: bold; 
                        }
                        .critical-row { background: #fee2e2; }
                        .warning-row { background: #fff7ed; }
                        .summary-box {
                            margin-top: 30px; 
                            padding: 20px; 
                            background: linear-gradient(135deg, #f8fafc, #e2e8f0); 
                            border-radius: 12px;
                            border: 2px solid #3b82f6;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <img src="https://idip.com.mx/wp-content/uploads/2024/08/logos-IDIP-sin-fondo-1-2.png" alt="IDIP Logo" class="logo">
                        <h1>üì¶ Reporte de Inventario IDIP</h1>
                        <p>Generado el: ${new Date().toLocaleString('es-MX')}</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-box critical">
                            <h3>${critical}</h3>
                            <p>Productos Cr√≠ticos</p>
                        </div>
                        <div class="stat-box warning">
                            <h3>${warning}</h3>
                            <p>Stock Bajo</p>
                        </div>
                        <div class="stat-box success">
                            <h3>${normal}</h3>
                            <p>Stock Normal</p>
                        </div>
                        <div class="stat-box info">
                            <h3>${formatCurrency(totalValue)}</h3>
                            <p>Valor Total</p>
                        </div>
                    </div>
                    
                    <h2>üìã Detalle de Productos</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>SKU</th>
                                <th>Categor√≠a</th>
                                <th>Stock</th>
                                <th>M√≠n/M√°x</th>
                                <th>Estado</th>
                                <th>Precio Compra</th>
                                <th>Valor Total</th>
                                <th>Proveedor</th>
                                <th>Ubicaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${inventory.map(item => {
                                const status = getStockStatus(item.currentStock, item.minStock);
                                const statusText = status === 'critical' ? 'CR√çTICO' : status === 'warning' ? 'BAJO' : 'NORMAL';
                                const rowClass = status === 'critical' ? 'critical-row' : status === 'warning' ? 'warning-row' : '';
                                const totalValue = item.currentStock * item.buyPrice;
                                
                                return `
                                    <tr class="${rowClass}">
                                        <td>${item.name}</td>
                                        <td>${item.sku}</td>
                                        <td>${item.category}</td>
                                        <td>${item.currentStock}</td>
                                        <td>${item.minStock} / ${item.maxStock}</td>
                                        <td>${statusText}</td>
                                        <td>${formatCurrency(item.buyPrice)}</td>
                                        <td>${formatCurrency(totalValue)}</td>
                                        <td>${item.supplier}</td>
                                        <td>${item.location}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    
                    <div class="summary-box">
                        <h3>üí∞ Resumen Financiero</h3>
                        <p><strong>Valor total del inventario:</strong> ${formatCurrency(totalValue)}</p>
                        <p><strong>Inversi√≥n requerida para reabastecimiento:</strong> ${formatCurrency(totalToOrder)}</p>
                        <p><strong>Total de productos:</strong> ${inventory.length}</p>
                        <p><strong>Reporte generado por:</strong> Dashboard IDIP - Sistema de Inventarios</p>
                    </div>
                </body>
                </html>
            `;
